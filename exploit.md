# Make an alias for regtest
alias r="bitcoin-cli -regtest"

# Get some coins
r generatetoaddress 1000 $(r getnewaddress)

# Alias hwi to testnet
alias hwi="hwi --testnet"

# Unlock trezor
$ hwi  --device-type=trezor --device-path=webusb:001:2 promptpin
Use 'sendpin' to provide the number positions for the PIN as displayed on your device's screen
Use the numeric keypad to describe number positions. The layout is:
    7 8 9
    4 5 6
    1 2 3
{"success": true}
$ hwi  --device-type=trezor --device-path=webusb:001:2 sendpin 756
{"success": true}

# Now fingerprint is available
$ hwi enumerate
[{"type": "trezor", "path": "webusb:001:2", "model": "trezor_1", "needs_pin_sent": false, "needs_passphrase_sent": false, "fingerprint": "9d033c9d"}]

# Get our segwit descriptor
$ hwi --fingerprint 9d033c9d getdescriptors
{"receive": ["pkh([9d033c9d/44h/1h/0h]tpubDDDnko2pXgEtziumR3dwbEJBXeWXfBF8TrDpv6kQADF5sepNLqy74YaSoaemyaBoGDyp3CwGy3y4dNA1Y2EoTfHfLShHEuihE6P3Vc4aRau/0/*)#4kad4sm2", "sh(wpkh([9d033c9d/49h/1h/0h]tpubDDRQXaJLwNpJ171sDpwsFLoh6g1vhpPfT5yKzQcgBRKQK1mGLbCrXzYhFMegYSZY19N1VvXJsHQ63YPrkq5zUjzggozK24ganJy2ryXsz8z/0/*))#uwduuu4v", "wpkh([9d033c9d/84h/1h/0h]tpubDDnKSwuYRuy5piDkAeASZZyabMXdxqjSJNtBCWpzcdSZdm2Q2SNBBepsza8nkjdiFjPDGRMiV7FbjBhHqk71RpjkFvgvZDKMjiCFPEFuVaT/0/*)#096gn2tn"], "internal": ["pkh([9d033c9d/44h/1h/0h]tpubDDDnko2pXgEtziumR3dwbEJBXeWXfBF8TrDpv6kQADF5sepNLqy74YaSoaemyaBoGDyp3CwGy3y4dNA1Y2EoTfHfLShHEuihE6P3Vc4aRau/1/*)#yzcvg9tj", "sh(wpkh([9d033c9d/49h/1h/0h]tpubDDRQXaJLwNpJ171sDpwsFLoh6g1vhpPfT5yKzQcgBRKQK1mGLbCrXzYhFMegYSZY19N1VvXJsHQ63YPrkq5zUjzggozK24ganJy2ryXsz8z/1/*))#f0r2yrqn", "wpkh([9d033c9d/84h/1h/0h]tpubDDnKSwuYRuy5piDkAeASZZyabMXdxqjSJNtBCWpzcdSZdm2Q2SNBBepsza8nkjdiFjPDGRMiV7FbjBhHqk71RpjkFvgvZDKMjiCFPEFuVaT/1/*)#73lfwlmt"]}

# Create a watch-only wallet
r createwallet segwit-bug true

# Export our descriptors to watch-only wallet

## Do it by hand
r -rpcwallet="segwit-bug" importmulti  '[{"desc":"wpkh([9d033c9d/84h/1h/0h]tpubDDnKSwuYRuy5piDkAeASZZyabMXdxqjSJNtBCWpzcdSZdm2Q2SNBBepsza8nkjdiFjPDGRMiV7FbjBhHqk71RpjkFvgvZDKMjiCFPEFuVaT/0/*)#096gn2tn","watchonly":true,"range":[0,100],"timestamp":"now"}]'

## Create a variable for the descriptor
DESC="wpkh([9d033c9d/84h/1h/0h]tpubDDnKSwuYRuy5piDkAeASZZyabMXdxqjSJNtBCWpzcdSZdm2Q2SNBBepsza8nkjdiFjPDGRMiV7FbjBhHqk71RpjkFvgvZDKMjiCFPEFuVaT/0/*)#096gn2tn"
r -rpcwallet="segwit-bug" importmulti '''[{"desc":"'$DESC'","watchonly":true,"range":[0,100],"timestamp":"now"}]'''

# Get some addresses
$ r -rpcwallet="segwit-bug" deriveaddresses $DESC [0,1]
[
  "bcrt1qvrr4j7ppgjjgz0x6julw782f0e8ymvaspdgeh5",
  "bcrt1qz5w3m4m6h57xxvundfuwv20aweg9ewuul25rnj"
]

# Now our wallet knows what these addresses mean 
# Maybe show how importmulti only includes this extra info b/c of a descriptor ...
$ r -rpcwallet="" getaddressinfo bcrt1qvrr4j7ppgjjgz0x6julw782f0e8ymvaspdgeh5
{
  "address": "bcrt1qvrr4j7ppgjjgz0x6julw782f0e8ymvaspdgeh5",
  "scriptPubKey": "001460c759782144a4813cda973eef1d497e4e4db3b0",
  "ismine": false,
  "solvable": false,
  "iswatchonly": false,
  "isscript": false,
  "iswitness": true,
  "witness_version": 0,
  "witness_program": "60c759782144a4813cda973eef1d497e4e4db3b0",
  "ischange": false,
  "labels": [
  ]
}
$ r -rpcwallet="segwit-bug" getaddressinfo bcrt1qvrr4j7ppgjjgz0x6julw782f0e8ymvaspdgeh5
{
  "address": "bcrt1qvrr4j7ppgjjgz0x6julw782f0e8ymvaspdgeh5",
  "scriptPubKey": "001460c759782144a4813cda973eef1d497e4e4db3b0",
  "ismine": false,
  "solvable": true,
  "desc": "wpkh([9d033c9d/84'/1'/0'/0/0]03c84bb97627c9edd650d2493897c40182a00b1e619c82788172af8a72ee7b53e2)#trru2dg4",
  "iswatchonly": true,
  "isscript": false,
  "iswitness": true,
  "witness_version": 0,
  "witness_program": "60c759782144a4813cda973eef1d497e4e4db3b0",
  "pubkey": "03c84bb97627c9edd650d2493897c40182a00b1e619c82788172af8a72ee7b53e2",
  "label": "",
  "ischange": false,
  "timestamp": 1591386009,
  "hdkeypath": "m/84'/1'/0'/0/0",
  "hdseedid": "0000000000000000000000000000000000000000",
  "hdmasterfingerprint": "9d033c9d",
  "labels": [
    {
      "name": "",
      "purpose": "receive"
    }
  ]
}

# Create 20BTC and 15BTC outputs





# Other

## Install trezorctl
pip3 install -U trezor

## Remove pin
trezorctl change-pin -r
